<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Client</title>
	<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
  </head>
  <body style="overflow:hidden; margin:0; padding:0;">
	<iframe src="" id="content" style="width:100vw; height:100vh; border:none"></iframe>
	<script type="text/javascript">
		const queryString = window.location.search;
		const urlParams = new URLSearchParams(queryString);
		const server = urlParams.has("server") ? urlParams.get('server') : window.location.hostname;
		const port = urlParams.has("port") ? urlParams.get('port') : "3001";
		const hostname = urlParams.has("hostname") ? urlParams.get('hostname') : "default";
		
		let current_url = "";
		
		var ws = new WebSocket("ws://"+server+":"+port+"?type=client&hostname="+hostname);

		ws.onopen = function() {
			ws.send(JSON.stringify({"type": "client", "msg": hostname}));
		};

		ws.onmessage = function (evt) { 
			var received_msg = evt.data;
			var jsonObject = JSON.parse(evt.data);

			let type = jsonObject.type;
			if(type == "send"){
				document.getElementById("content").src = jsonObject.msg;
				current_url = jsonObject.msg;
			}
			if(type == "get"){
				ws.send(JSON.stringify({"type": "get", "msg": current_url}));
			}
		};

		ws.onclose = function() { 
			console.log("Connection is closed..."); 
		};
	</script>
  </body>
</html>